---
import Topbar from "../../components/Topbar.astro";
import Footer from "../../components/Footer.astro";
import RecentCards from "../../components/RecentCards.astro";
import MetadataHead from "../../components/MetadataHead.astro";
import {
  SITE_TITLE_SEPARATOR,
  SITE_TITLE,
  SITE_TITLE_DEVANAGRI,
  Tags,
} from "../../utils/consts";
import { getCollection } from "astro:content";
import SearchModal from "../../components/SearchModal.astro";

// this genraes
export async function getStaticPaths(): Promise<any> {
  const allPosts: any = await Astro.glob("../../content/page/*.md");

  return Tags.map((_tag) => {
    return {
      params: {
        tag: _tag,
      },
      props: { posts: allPosts },
    };
  });
}

const { tag } = Astro.params;
const { posts } = Astro.props;
// const filteredPosts = (posts as any[]).filter((post: any) => post.frontmatter.tags?.includes(tag));

const MyPagesCollection = (await getCollection("page"))
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
  .filter((item) => item.data.tags?.includes(tag));

const canonicalURL = new URL(Astro.url.pathname, Astro.site);
const ogSiteName = `${SITE_TITLE_DEVANAGRI} ${SITE_TITLE_SEPARATOR} ${SITE_TITLE}`;
const pageName = `${tag} ${SITE_TITLE_SEPARATOR} Pages Tagged with ${tag} ${SITE_TITLE_SEPARATOR} ${ogSiteName}`;

const ldSchema = {
  "@context": "https://schema.org",
  "@type": "Series",
  publisher: {
    "@type": "Organization",
    name: ogSiteName,
    url: "https://brahmadev.in/",
    logo: {
      "@type": "ImageObject",
      url: "https://brahmadev.in/assets/images/brahma-icon.png",
      width: 60,
      height: 60,
    },
  },
  url: Astro.url,
  name: tag,
  mainEntityOfPage: Astro.url,
};
---

<html lang="en">
  <head>
    <MetadataHead />

    <link rel="canonical" href={canonicalURL} />
    <title>{pageName}</title>
    <meta property="og:type" content="website" />
    <meta property="og:url" content={Astro.url} />
    <meta property="og:title" content={pageName} />
    <meta property="og:site_name" content={ogSiteName} />

    <script type="application/ld+json" set:html={JSON.stringify(ldSchema)}>
    </script>




  </head>

  <body class="bg-gray-900 min-h-screen">
    <Topbar />
    <SearchModal />

    <!-- Hero Section -->
    <div class="relative pt-24 pb-12 bg-gradient-to-b from-gray-900 via-slate-900 to-gray-800">
      <div class="max-w-7xl mx-auto px-4">
        <!-- Breadcrumb -->
        <nav class="mb-6 flex items-center text-sm text-white/60">
          <a href="/tags" class="hover:text-yellow-400 transition-colors">Tags</a>
          <svg class="w-4 h-4 mx-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
          </svg>
          <span class="text-white capitalize">{tag}</span>
        </nav>

        <div class="text-center mb-8">
          <div class="inline-flex items-center gap-3 mb-4">
            <span class="text-5xl text-yellow-400">#</span>
            <h1 class="text-4xl md:text-5xl font-bold text-yellow-400 capitalize">
              {tag}
            </h1>
          </div>
          <p class="text-white/70 text-lg">
            {MyPagesCollection.length}&nbsp;{MyPagesCollection.length === 1 ? 'item' : 'items'} in this collection
          </p>
        </div>
      </div>
    </div>

    <!-- Content Section -->
    <div class="bg-gray-900 py-12">
      <div class="max-w-7xl mx-auto px-4">
        {MyPagesCollection.length > 0 ? (
          <RecentCards pages={MyPagesCollection} />
        ) : (
          <div class="max-w-2xl mx-auto">
            <div class="bg-slate-800/60 backdrop-blur-sm rounded-xl p-12 border border-slate-700 text-center">
              <div class="text-6xl mb-4">ðŸ“š</div>
              <h2 class="text-2xl font-bold text-white mb-3">
                No documents found
              </h2>
              <p class="text-white/70 mb-8">
                Content for this tag is being added soon. Stay tuned!
              </p>
              <a
                href="/tags"
                class="inline-flex items-center gap-2 bg-gradient-to-r from-orange-500 to-red-500 
                       hover:from-orange-600 hover:to-red-600 text-white font-bold py-3 px-6 
                       rounded-lg transition-all duration-300 hover:scale-105 shadow-lg"
              >
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
                </svg>
                Browse All Tags
              </a>
            </div>
          </div>
        )}
      </div>
    </div>

    <Footer />
  </body>
</html>
